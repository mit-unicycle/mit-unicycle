<!doctype html>
<html lang="en">

<head>
        <title>Software - CS-358 Self Balancing Robot</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        <link rel="canonical" href="https://mit-unicycle.github.io/mit-unicycle/software/usage/">
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../assets/css/dracula-ui.css">
        <link rel="stylesheet" href="../../assets/css/mkdocs.css">
            <link href="../../css/custom.css" rel="stylesheet">
            <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" rel="stylesheet">

        
            <link  rel="icon" type="image/x-icon" href="../../assets/img/favicon.ico">
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>

</head>

<body class="drac-bg-black-secondary drac-text-grey-ternary drac-text drac-scrollbar-purple">

    <main class="d-flex">

        <!-- block sidebar -->
            <nav id="sidebar" class="sidebar drac-bg-black">
    <div class="custom-menu">
        <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Menu</span>
        </button>
    </div>

    <div class="p-4">
        

        <div class="drac-text-center">
            
                <span class="drac-text drac-line-height drac-text-white">CS-358 Self Balancing Robot</span>
            
        </div>

        <div class="drac-box flex-column">
            <ul class="dot-ul">
                <li><div class="dot-li drac-bg-cyan"></div></li>
                <li><div class="dot-li drac-bg-green"></div></li>
                <li><div class="dot-li drac-bg-orange"></div></li>
                <li><div class="dot-li drac-bg-pink"></div></li>
                <li><div class="dot-li drac-bg-purple"></div></li>
                <li><div class="dot-li drac-bg-red"></div></li>
                <li><div class="dot-li drac-bg-yellow"></div></li>
            </ul>
        </div>

        <hr class="drac-divider" />

        <!-- block menu -->
        <ul class="mb-5 drac-list drac-list-none">
            
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Home
                </a>
            </li>
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#building-the-prototype-collapse" aria-expanded="false">
                    Building the Prototype
                </a>
                <div class="collapse" id="building-the-prototype-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../../building/physics/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Underlying Physic
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../building/components/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Components Used
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../building/manufacturing/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Manufacturing
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../building/assembly/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Assembly Instructions
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../building/wiring/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Wiring Instructions
        </a>
    </li>
                    </ul>
                </div>
            </li>
            <li class="drac-box">
                <a href="../.."
                    class=" active 
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#software-instructions-collapse" aria-expanded="false">
                    Software Instructions
                </a>
                <div class="collapse" id="software-instructions-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../controller/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Controller Explanation
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="./"
            class=" active 
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Software
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../tuning/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Tuning Guide
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../webapp/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Web App
        </a>
    </li>
                    </ul>
                </div>
            </li>
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#process-collapse" aria-expanded="false">
                    Process
                </a>
                <div class="collapse" id="process-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../../process/prototypes/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Prototype History
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../process/challenges/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Challenges Faced
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../process/improvements/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Future Improvements
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../process/thanks/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Thanks
        </a>
    </li>
                    </ul>
                </div>
            </li>
        </ul>
        <!-- endblock -->
    </div>
</nav>
        <!-- endblock -->

        <nav class="divider drac-bg-purple-cyan"></nav>

        <div class="content">
            <!-- block header -->
                <header>
    <nav class="navbar navbar-expand-xl drac-bg-purple"">
        <div class="container-fluid">

            <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMenu"
                aria-controls="navbarsMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button> -->

            <div class="collapse navbar-collapse flex-column ml-auto" id="navbarsMenu">
                <ul class="navbar-nav">

                    <!-- block preview -->
                    <li class="nav-item">
                            
        <div class="container">
            <div class="row row-preview">
                <div class="col">
                    <a href="../controller/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </div>
                <div class="col">
                    <a href="../tuning/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover" style="padding-left: 3%;">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
                    </li>
                    <!--  endblock -->

                    <!-- block search -->
                    <li class="nav-item"><div role="search" class="search-box">
	<form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
		<input type="text" name="q" class="drac-input drac-input-search drac-input-white drac-text-white drac-bg-black-secondary"
		placeholder="Search docs" title="Type search term here" />
	</form>
</div>
                    </li>
                    <!--  endblock -->

                    <!-- block source -->
                    <li class="nav-item">
                        
                    </li>
                    <!--  endblock -->

                </ul>
            </div>

        </div>
    </nav>
</header>
            <!-- endblock -->

            <!-- block content -->
                <div class="tl-inner-radius"> 
    <div></div>
    <div></div>
</div>
<!-- copy/pasted from original dracula theme -->
<section class="p-md-5 section-content">
    <article>
        <p><h1 id="software-explanation-and-usage">Software Explanation and Usage</h1>
<p>The software structure is simple. There is a folder named <em>classes</em> which contains all the c++ classes used in the main <em>Self_balancing.ino</em> file. We decided to use classes to improve the reusability and modularity of the code. Although we will briefly discuss each class here, we invite you to read the code to have a better understanding of it. </p>
<h2 id="self_balancingino">Self_balancing.ino</h2>
<p>This is the main file that combines together all the other classes. It setups the MQTT communication, namely retrieving the parameters from the web app. It also loops over the finite state machine (FSM).</p>
<h2 id="fsmcpp">FSM.cpp</h2>
<p>This class models a FSM for the balancing robot. It has different states it can be set to, in order to facilitate the control of the robot. The most important function in this class is called <em>loop()</em>. It is in charge of updating the FSM. Most importantly, it calls the computation of the PID output. The different states are: </p>
<ul>
<li>Disabled: If the robot has fallen beyond a certain angle, it will turn off the motors to avoid any harm to us or the wheels. </li>
<li>Balance</li>
<li>Debug: Similar to <em>Balance</em>, but it will print useful information. </li>
<li>Tuning: Used to calibrating the MPU6050's offsets. </li>
</ul>
<h2 id="gyrocpp">Gyro.cpp</h2>
<p>This class is used to interface with the MPU6050 and retrieve the roll, pitch and yaw angles. </p>
<h2 id="mpucalibrationcpp">mpuCalibration.cpp</h2>
<p>This is a very useful class to calibrate the MPU6050. Every time the MPU6050's angle readings appear incorrect, it means it must be calibrated. This class is therefore used to find the offsets for the MPU6050. </p>
<h2 id="mqttclientcpp">mqttClient.cpp</h2>
<p>This class is used for the MQTT connection and messages. We used the MQTT protocol to update the tunings of the robot, like the gains and the setpoint, without having to reupload the code. </p>
<h2 id="mypidcontroller">MyPIDController</h2>
<p>This was a class we created while trying to get the first prototype to work. It is an implementation of a PID Controller following <a href="https://youtu.be/zOByx3Izf5U">Phil’s Lab video</a>, but without using any external libraries.</p>
<h2 id="pidautotunercpp">pidautotuner.cpp</h2>
<p>This is another class we created while trying to get the prototype to work. We were having lots of problems with the tuning of the gains, so we tried to use an auto-tuner. In the end, the problem was that the ESC. Once we changed that, it was much easier to find the parameters manually. </p>
<h2 id="pidcontrolcpp">PIDControl.cpp</h2>
<p>This is a wrapper class for the excellent <a href="https://playground.arduino.cc/Code/PIDLibrary/">PID library</a> created by Brett Beauregard. This is the one we ended up using, as it has many useful features as integration clamping, derivative-on-measurement and many more. See <a href="http://brettbeauregard.com/blog/category/pid/coding/">this link</a> to find out more. </p>
<h2 id="schedulercpp">Scheduler.cpp</h2>
<p>The scheduler is a sort of timer that allows us to run different parts of the code at different frequencies. </p>
<h2 id="vesccpp">VESC.cpp</h2>
<p>This class is used to interface with the FSESC.</p></p>
    </article>
</section>
            <!-- endblock -->

            <!-- block footer -->
                <footer>
    <div class="d-flex flex-sm-row justify-content-between py-2 border-top drac-text-black drac-bg-cyan-green">
        <a href="https://github.com/dracula/mkdocs" target="_blank" style="padding-left: 1%;"
            class="footer-text drac-anchor drac-text-black drac-text-purple--hover">
            Made with Dracula Theme for MkDocs
        </a>
    </div>
</footer>
            <!-- endblock -->
        </div>

    </main>

        <script>var base_url = '../..';</script>
        <script src="../../assets/js/jquery-3.3.1.slim.min.js""></script>
        <script src="../../assets/js/bootstrap.bundle.min.js""></script>
        <script src="../../assets/js/mkdocs.js""></script>
			<script src="../../javascript/katex.js" defer></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js" defer></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js" defer></script>
			<script src="../../search/main.js" defer></script>

</body>

</html>
